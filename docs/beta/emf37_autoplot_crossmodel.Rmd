---
title: "EMF37 Cross-Model Comparison Plots"
author: ""
date: "`r Sys.Date()`"
output:  
  html_document:
    toc: true
    toc_depth: 5
    theme: cerulean
    toc_float: 
      collapsed: true
      smooth_scroll: true
---

<script>
    $(document).ready(function() {
      $items = $('div#TOC li');
      $items.each(function(idx) {
        num_ul = $(this).parentsUntil('#TOC').length;
        $(this).css({'text-indent': num_ul * 20, 'padding-left': 20});
      });

    });
</script>


```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = here::here())
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
```


```{r packages, include=FALSE}
source("packages.R")

library(knitr)
library(ggplot2)
library(plotly)
#library(DT)
library(ggthemes)
library(htmltools)
```


```{r data, include=FALSE}
tar_load(emf_data_long)
emf_data_long <- emf_data_long %>%
   filter(model != "EIA_STEO")
```


```{r dataprep, include=FALSE}

all_models <- unique(emf_data_long$model)

# first model in the list is the base against which others are compared.
# order determines faceting/color assignment order.

all_scenarios <- unique(emf_data_long$scenario)
core_scenarios <- c("NT.Ref", "0by50.Ref", "0by60.Ref", "0by80.Ref")
ref_scen <- "NT.Ref"


# ref_by_fuel <- ces_by_fuel %>% filter(str_detect(scenario, "^Ref"), model %in% comp_models)

# Variables included in EIA data
eia_var <- emf_data_long %>%
  filter(str_detect(model, 'AEO|EIA')) %>%
  distinct(variable) %>%
  pull(variable) %>%
  unique()

all_variables <- unique(emf_data_long$variable)

scenarios <- unique(emf_data_long$scenario)

mods <- unique(emf_data_long$model) %>% setdiff(c("AEO2020", "EIA_STEO", "EIA_Historic"))


# Run the required functions
source("R/autoplot_funs.R")

ref_data <- filter(emf_data_long, scenario %in% ref_scen & !is.na(value))
pol_data <- filter(emf_data_long, !scenario %in% ref_scen & !is.na(value))

```


&nbsp;

&nbsp;

# Figures

## Emissions

## {.tabset .tabset-pills}

### Reference scenarios

```{r, echo = FALSE, eval = TRUE, message = FALSE}

# Identify the variables that we want to plot
emissions_var <- c("Emissions|CO2|Energy",
                   "Emissions|CO2|Energy|Coal",
                   "Emissions|CO2|Energy|Gas",
                   "Emissions|CO2|Energy|Oil",
                   "Emissions|CO2|Energy|Supply|Electricity",
                   "Emissions|CO2|Energy|Supply|Electricity|Biomass",
                   "Emissions|CO2|Energy|Supply|Electricity|Coal",
                   "Emissions|CO2|Energy|Supply|Electricity|Gas",
                   "Emissions|CO2|Energy|Supply|Electricity|Oil",
                   "Emisssions|CO2|Energy|Demand|Buildings",
                   "Emisssions|CO2|Energy|Demand|Buildings|Commercial",
                   "Emisssions|CO2|Energy|Demand|Buildings|Residential",
                   "Emisssions|CO2|Energy|Demand|Industry",
                   "Emisssions|CO2|Energy|Demand|Industry|EInt Mfg",
                   "Emisssions|CO2|Energy|Demand|Industry|Non Mfg",
                   "Emisssions|CO2|Energy|Demand|Industry|NonEInt Mfg",
                   "Emisssions|CO2|Energy|Demand|Transportation",
                   "Emisssions|CO2|Energy|Demand|Transportation|Freight",
                   "Emisssions|CO2|Energy|Demand|Transportation|Passenger",
                   "Emisssions|CO2|Energy|Demand|Transportation|Passenger|Road")


# Use plot functions to generate a list of plots and use htmltools::tagList to render the plots
list_of_plots <- lapply(
  emissions_var, plot_list_function_model_scenario, 
  plot_model = ref_data)  
htmltools::tagList(list_of_plots)
 
```

### Policy scenarios

```{r, echo = FALSE, eval = TRUE, message = FALSE}


# Use plot functions to generate a list of plots and use htmltools::tagList to render the plots 
list_of_plots <- lapply(
  emissions_var, plot_list_function_model_scenario, 
  plot_model = pol_data, 
  post_label = 'CO2 Emissions')  
 htmltools::tagList(list_of_plots)
```



## Final Energy 

## {.tabset .tabset-pills} 

### Reference scenarios 

```{r, echo = FALSE, eval = TRUE, message = FALSE}
# Identify the variables that we want to plot

final_energy_vars <- c("Final Energy",
                       "Final Energy|Biogas",
                       "Final Energy|Buildings",
                       "Final Energy|Buildings|Commercial|Electricity",
                       "Final Energy|Buildings|Commercial|Gas",
                       "Final Energy|Buildings|Commercial|Oil",
                       "Final Energy|Buildings|Coal",
                       "Final Energy|Buildings|Electricity",
                       "Final Energy|Buildings|Gas",
                       "Final Energy|Buildings|Hydrogen",
                       "Final Energy|Buildings|Oil",
                       "Final Energy|Buildings|Residential|Electricity",
                       "Final Energy|Buildings|Residential|Gas",
                       "Final Energy|Buildings|Residential|Oil",
                       "Final Energy|Coal",
                       "Final Energy|Electricity",
                       "Final Energy|Gas",
                       "Final Energy|Geothermal",
                       "Final Energy|Heat",
                       "Final Energy|Hydrogen",
                       "Final Energy|Industry",
                       "Final Energy|Industry|Coal",
                       "Final Energy|Industry|Electricity",
                       "Final Energy|Industry|Gas",
                       "Final Energy|Industry|Hydrogen",
                       "Final Energy|Industry|Oil",
                       "Final Energy|Transportation",
                       "Final Energy|Transportation|Electricity",
                       "Final Energy|Transportation|Freight|Biogas",
                       "Final Energy|Transportation|Freight|Biomass liquids",
                       "Final Energy|Transportation|Freight|Electricity",
                       "Final Energy|Transportation|Freight|Gas",
                       "Final Energy|Transportation|Freight|Hydrogen",
                       "Final Energy|Transportation|Freight|Oil",
                       "Final Energy|Transportation|Gas",
                       "Final Energy|Transportation|Hydrogen",
                       "Final Energy|Transportation|Oil",
                       "Final Energy|Transportation|Passenger|Biogas",
                       "Final Energy|Transportation|Passenger|Biomass liquids",
                       "Final Energy|Transportation|Passenger|Electricity",
                       "Final Energy|Transportation|Passenger|Gas",
                       "Final Energy|Transportation|Passenger|Hydrogen",
                       "Final Energy|Transportation|Passenger|Oil",
                       "Final Energy|Transportation|Passenger|Road|Biogas",
                       "Final Energy|Transportation|Passenger|Road|Biomass liquids",
                       "Final Energy|Transportation|Passenger|Road|Electricity",
                       "Final Energy|Transportation|Passenger|Road|Gas",
                       "Final Energy|Transportation|Passenger|Road|Hydrogen",
                       "Final Energy|Transportation|Passenger|Road|Oil")


# Generate list of plots    
list_of_plots <- lapply(
  final_energy_vars, plot_list_function_model_scenario, 
  plot_model = ref_data, 
  header_function = simple_header)

htmltools::tagList(list_of_plots)
```

### Policy scenarios 

```{r, echo = FALSE, eval = TRUE, message = FALSE}

list_of_plots <- lapply(
  final_energy_vars, plot_list_function_model_scenario, 
  plot_model = pol_data, 
  header_function = simple_header)

 htmltools::tagList(list_of_plots)
```


## GDP

## {.tabset .tabset-pills}

### Reference scenarios

```{r, echo = FALSE, eval = TRUE, message = FALSE}
gdp_vars <- c("GDP|Consumption",
              "GDP|Exports",
              "GDP|Government",
              "GDP|Imports",
              "GDP|Investment",
              "GDP|MER")

# Generate the list of plots   
list_of_plots <- lapply(gdp_vars, plot_list_function_model_scenario, plot_model = ref_data)  

 htmltools::tagList(list_of_plots)
```

### Policy scenarios

```{r, echo = FALSE, eval = TRUE, message = FALSE}

# Generate the list of plots    
list_of_plots <- lapply(gdp_vars, plot_list_function_model_scenario, plot_model = pol_data)  

 htmltools::tagList(list_of_plots)
```


## Generation

## {.tabset .tabset-pills} 

### Reference scenarios 

```{r, echo = FALSE, eval = TRUE, message = FALSE}

generation_vars <- c("Secondary Energy|Electricity",
                     "Secondary Energy|Electricity|Biomass",
                     "Secondary Energy|Electricity|Coal",
                     "Secondary Energy|Electricity|Curtailment",
                     "Secondary Energy|Electricity|Gas",
                     "Secondary Energy|Electricity|Geothermal",
                     "Secondary Energy|Electricity|Hydro",
                     "Secondary Energy|Electricity|Imports",
                     "Secondary Energy|Electricity|Losses",
                     "Secondary Energy|Electricity|Non-Biomass Renewables",
                     "Secondary Energy|Electricity|Nuclear",
                     "Secondary Energy|Electricity|Ocean",
                     "Secondary Energy|Electricity|Oil",
                     "Secondary Energy|Electricity|Solar",
                     "Secondary Energy|Electricity|Storage",
                     "Secondary Energy|Electricity|Wind")

 
# Generate list of plots   
list_of_plots <- lapply(generation_vars, plot_list_function_model_scenario, plot_model = ref_data, header_function = simple_header)  

 htmltools::tagList(list_of_plots)
```

### Policy scenarios 

```{r, echo = FALSE, eval = TRUE, message = FALSE}

list_of_plots <- lapply(generation_vars, plot_list_function_model_scenario, plot_model = pol_data, header_function = simple_header)

htmltools::tagList(list_of_plots)
```


## Primary Energy

## {.tabset .tabset-pills}

### Reference scenarios

```{r, echo = FALSE, eval = TRUE, message = FALSE}
primary_vars <- c("Primary Energy",
                  "Primary Energy|Biomass",
                  "Primary Energy|Biomass|1st Generation",
                  "Primary Energy|Biomass|Electricity",
                  "Primary Energy|Biomass|Electricity|w/ CCS",
                  "Primary Energy|Biomass|Electricity|w/o CCS",
                  "Primary Energy|Biomass|Energy Crops",
                  "Primary Energy|Biomass|Gases",
                  "Primary Energy|Biomass|Hydrogen",
                  "Primary Energy|Biomass|Liquids",
                  "Primary Energy|Biomass|Modern",
                  "Primary Energy|Biomass|Modern|w/ CCS",
                  "Primary Energy|Biomass|Modern|w/o CCS",
                  "Primary Energy|Biomass|Residues",
                  "Primary Energy|Biomass|Solids",
                  "Primary Energy|Biomass|Traditional",
                  "Primary Energy|Coal",
                  "Primary Energy|Coal|Electricity",
                  "Primary Energy|Coal|Electricity|w/ CCS",
                  "Primary Energy|Coal|Electricity|w/o CCS",
                  "Primary Energy|Coal|Gases",
                  "Primary Energy|Coal|Hydrogen",
                  "Primary Energy|Coal|Liquids",
                  "Primary Energy|Coal|Solids",
                  "Primary Energy|Coal|w/ CCS",
                  "Primary Energy|Coal|w/o CCS",
                  "Primary Energy|Fossil",
                  "Primary Energy|Fossil|w/ CCS",
                  "Primary Energy|Fossil|w/o CCS",
                  "Primary Energy|Gas",
                  "Primary Energy|Gas|Electricity",
                  "Primary Energy|Gas|Electricity|w/ CCS",
                  "Primary Energy|Gas|Electricity|w/o CCS",
                  "Primary Energy|Gas|Gases",
                  "Primary Energy|Gas|Hydrogen",
                  "Primary Energy|Gas|Liquids",
                  "Primary Energy|Gas|Solids",
                  "Primary Energy|Gas|w/ CCS",
                  "Primary Energy|Gas|w/o CCS",
                  "Primary Energy|Geothermal",
                  "Primary Energy|Hydro",
                  "Primary Energy|Non-Biomass Renewables",
                  "Primary Energy|Nuclear",
                  "Primary Energy|Ocean",
                  "Primary Energy|Oil",
                  "Primary Energy|Oil|Electricity",
                  "Primary Energy|Oil|Electricity|w/ CCS",
                  "Primary Energy|Oil|Electricity|w/o CCS",
                  "Primary Energy|Oil|Gases",
                  "Primary Energy|Oil|Hydrogen",
                  "Primary Energy|Oil|Liquids",
                  "Primary Energy|Oil|Solids",
                  "Primary Energy|Oil|w/ CCS",
                  "Primary Energy|Oil|w/o CCS",
                  "Primary Energy|Other",
                  "Primary Energy|Secondary Energy Trade",
                  "Primary Energy|Solar",
                  "Primary Energy|Wind",
                  "Production|Primary Energy|Coal",
                  "Production|Primary Energy|Gas",
                  "Production|Primary Energy|Oil")


# Generate list of plots    
list_of_plots <- lapply(
  primary_vars, plot_list_function_model_scenario, 
  plot_model = ref_data)  

 htmltools::tagList(list_of_plots)
```

### Policy scenarios

```{r, echo = FALSE, eval = TRUE, message = FALSE}

# Generate list of plots    
list_of_plots <- lapply(
  primary_vars, plot_list_function_model_scenario, 
  plot_model = pol_data)  

 htmltools::tagList(list_of_plots)
```


